# ğŸ”„ Discount System - Complete Workflow

## ğŸ“Š Visual Workflow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ADMIN CREATES DISCOUNT                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                                       â”‚
        â–¼                                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   CREATE      â”‚                      â”‚   CREATE      â”‚
â”‚   COUPON      â”‚                      â”‚  GIFT CARD    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                                       â”‚
        â”‚ Code: SAVE20                          â”‚ Code: ABCD-1234
        â”‚ 20% off                               â”‚ $100 balance
        â”‚ Min: $50                              â”‚ Expires: 2025
        â”‚                                       â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              CUSTOMER ADDS ITEMS TO CART                    â”‚
â”‚  Item 1: $50  |  Item 2: $30  |  Subtotal: $80            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           CUSTOMER ENTERS SHIPPING ADDRESS                  â”‚
â”‚  Address: 123 Main St, Ottawa, ON                          â”‚
â”‚  Shipping Calculated: $10                                   â”‚
â”‚  Total Before Discount: $90                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                                       â”‚
        â–¼                                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  APPLY        â”‚                      â”‚  APPLY        â”‚
â”‚  COUPON       â”‚                      â”‚  GIFT CARD    â”‚
â”‚  "SAVE20"     â”‚                      â”‚  "ABCD-1234"  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                                       â”‚
        â”‚ Validates:                            â”‚ Validates:
        â”‚ âœ“ Code exists                         â”‚ âœ“ Code exists
        â”‚ âœ“ Not expired                         â”‚ âœ“ Not expired
        â”‚ âœ“ Usage limit OK                      â”‚ âœ“ Has balance
        â”‚ âœ“ Min amount met                      â”‚ âœ“ Not expired
        â”‚                                       â”‚
        â”‚ Calculates:                           â”‚ Calculates:
        â”‚ 20% of $80 = $16                      â”‚ Min($50, $80) = $50
        â”‚                                       â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              AUTOMATIC DISCOUNTS APPLIED                     â”‚
â”‚  Cart Threshold: $80 â†’ No discount (need $100+)             â”‚
â”‚  First-Time Buyer: 10% off â†’ $8                             â”‚
â”‚  Bulk Quantity: 2 items â†’ No discount (need 10+)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FINAL CALCULATION                         â”‚
â”‚                                                              â”‚
â”‚  Subtotal:              $80.00                               â”‚
â”‚  Coupon (SAVE20):      -$16.00                               â”‚
â”‚  Gift Card:            -$50.00                               â”‚
â”‚  Auto Discount:         -$8.00                               â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                            â”‚
â”‚  After Discounts:        $6.00                               â”‚
â”‚  Shipping:            +$10.00                               â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                            â”‚
â”‚  FINAL TOTAL:          $16.00                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CHECKOUT & PAYMENT                        â”‚
â”‚  Customer pays: $16.00 (discounted amount)                  â”‚
â”‚  Payment processed via Stripe                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ORDER CREATED                           â”‚
â”‚  Order saved with discount information:                      â”‚
â”‚  - Coupon: SAVE20, Discount: $16                             â”‚
â”‚  - Gift Card: ABCD-1234, Used: $50                          â”‚
â”‚  - Auto Discount: $8                                        â”‚
â”‚  - Total Discount: $74                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    USAGE RECORDED                            â”‚
â”‚  Coupon:                                                    â”‚
â”‚  - Usage count: +1                                          â”‚
â”‚  - User usage: +1                                           â”‚
â”‚                                                              â”‚
â”‚  Gift Card:                                                 â”‚
â”‚  - Balance: $100 â†’ $50                                      â”‚
â”‚  - Usage history: +1 entry                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ Step-by-Step: Admin Creates Coupon

```
1. Admin Login
   â””â”€> Admin Panel
       â””â”€> Sidebar Menu
           â””â”€> Click "Coupons"
               â””â”€> Click "Add Coupon"
                   â””â”€> Fill Form
                       â”œâ”€> Code: SAVE20
                       â”œâ”€> Type: Percentage
                       â”œâ”€> Amount: 20
                       â”œâ”€> Min: 50
                       â””â”€> Click "Create"
                           â””â”€> âœ… Coupon Created!
```

---

## ğŸ›’ Step-by-Step: Customer Uses Discount

```
1. Customer Browses
   â””â”€> Adds Items to Cart
       â””â”€> Goes to Cart Page
           â””â”€> Enters Shipping Address
               â””â”€> Shipping Calculated
                   â””â”€> Sees "Promo Code" Section
                       â””â”€> Clicks "Promo Code" Tab
                           â””â”€> Enters: SAVE20
                               â””â”€> Clicks "Apply"
                                   â”œâ”€> API Call: /api/coupons/apply
                                   â”œâ”€> Validation: âœ… Valid
                                   â”œâ”€> Calculation: 20% of $80 = $16
                                   â””â”€> Cart Updates
                                       â”œâ”€> Shows Discount: -$16
                                       â”œâ”€> Shows New Total: $74
                                       â””â”€> Customer Proceeds to Checkout
                                           â””â”€> Pays Discounted Amount
                                               â””â”€> Order Created
                                                   â””â”€> Usage Recorded
```

---

## ğŸ”¢ Calculation Examples

### **Example 1: Simple Percentage Discount**

```
Cart Subtotal:        $100.00
Coupon (20% off):     -$20.00
Shipping:             +$10.00
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Final Total:           $90.00
```

### **Example 2: Coupon + Gift Card**

```
Cart Subtotal:        $150.00
Coupon (10% off):     -$15.00
                      â”€â”€â”€â”€â”€â”€â”€â”€
After Coupon:         $135.00
Gift Card ($50):      -$50.00
Shipping:             +$10.00
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Final Total:           $95.00
```

### **Example 3: Multiple Discounts**

```
Cart Subtotal:        $200.00
Coupon (15% off):     -$30.00
                      â”€â”€â”€â”€â”€â”€â”€â”€
After Coupon:         $170.00
Gift Card ($100):     -$100.00
                      â”€â”€â”€â”€â”€â”€â”€â”€
After Gift Card:       $70.00
Auto Discount (3%):    -$6.00  (3% of $200)
                      â”€â”€â”€â”€â”€â”€â”€â”€
After Auto:            $64.00
Shipping:             +$10.00
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Final Total:           $74.00
```

### **Example 4: Free Shipping Coupon**

```
Cart Subtotal:        $100.00
Shipping:             +$10.00
                      â”€â”€â”€â”€â”€â”€â”€â”€
Before Discount:      $110.00
Coupon (Free Ship):   -$10.00  (shipping waived)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Final Total:          $100.00
```

---

## ğŸ“± User Interface Flow

### **Cart Page:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Cart Items                         â”‚
â”‚  - Item 1: $50                     â”‚
â”‚  - Item 2: $30                     â”‚
â”‚  Subtotal: $80                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Shipping Address Input             â”‚
â”‚  [Enter address...]                 â”‚
â”‚  Shipping: $10                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ’° Discounts                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ [Promo Code] [Gift Card]    â”‚   â”‚
â”‚  â”‚                             â”‚   â”‚
â”‚  â”‚ [Enter code...] [Apply]    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                     â”‚
â”‚  âœ… SAVE20 Applied                 â”‚
â”‚  Discount: -$16.00                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Total: $74.00                      â”‚
â”‚  [Proceed to Checkout]              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **Checkout Page:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Order Summary                      â”‚
â”‚  - Item 1: $50                     â”‚
â”‚  - Item 2: $30                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Subtotal:        $80.00            â”‚
â”‚  Shipping:        $10.00            â”‚
â”‚  Coupon (SAVE20): -$16.00           â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€          â”‚
â”‚  Total:            $74.00            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [Pay $74.00]                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” Validation Flow

### **Coupon Validation:**

```
Enter Code: "SAVE20"
    â”‚
    â–¼
Check if exists
    â”‚
    â”œâ”€> âŒ Not Found â†’ Error: "Invalid coupon code"
    â”‚
    â””â”€> âœ… Found
        â”‚
        â–¼
Check if active
    â”‚
    â”œâ”€> âŒ Inactive â†’ Error: "Coupon is not active"
    â”‚
    â””â”€> âœ… Active
        â”‚
        â–¼
Check expiry date
    â”‚
    â”œâ”€> âŒ Expired â†’ Error: "Coupon has expired"
    â”‚
    â””â”€> âœ… Valid Date
        â”‚
        â–¼
Check usage limit
    â”‚
    â”œâ”€> âŒ Limit Reached â†’ Error: "Usage limit reached"
    â”‚
    â””â”€> âœ… Has Usage Left
        â”‚
        â–¼
Check user usage
    â”‚
    â”œâ”€> âŒ User Limit Reached â†’ Error: "You've already used this"
    â”‚
    â””â”€> âœ… User Can Use
        â”‚
        â–¼
Check minimum amount
    â”‚
    â”œâ”€> âŒ Below Minimum â†’ Error: "Minimum $50 required"
    â”‚
    â””â”€> âœ… Meets Minimum
        â”‚
        â–¼
Calculate Discount
    â”‚
    â””â”€> âœ… Discount Applied!
```

---

## ğŸ’¾ Data Flow

### **Order Creation with Discounts:**

```javascript
// Cart Page
discounts = {
  coupon: { code: "SAVE20", discount: 16 },
  giftCard: { code: "ABCD-1234", discount: 50 },
  totalDiscount: 66,
  finalTotal: 24
}

// Passed to Checkout
history("/checkout", { state: { discounts } })

// Checkout Page
const { discounts } = location.state
// Uses discounts.finalTotal for payment

// Order Creation
const order = {
  products: [...],
  totalAmt: 24,  // Discounted total
  discounts: {
    couponCode: "SAVE20",
    couponDiscount: 16,
    giftCardCode: "ABCD-1234",
    giftCardDiscount: 50,
    totalDiscount: 66
  }
}

// Usage Recording
POST /api/discounts/record-usage
{
  orderId: "...",
  couponCode: "SAVE20",
  giftCardCode: "ABCD-1234",
  couponDiscount: 16,
  giftCardDiscount: 50
}
```

---

## ğŸ¨ Component Structure

```
Cart Page (index.jsx)
â”œâ”€> DiscountInput Component
â”‚   â”œâ”€> Promo Code Tab
â”‚   â”‚   â””â”€> Input + Apply Button
â”‚   â””â”€> Gift Card Tab
â”‚       â””â”€> Input + Apply Button
â”‚
â”œâ”€> Discount Display
â”‚   â”œâ”€> Coupon Discount
â”‚   â”œâ”€> Gift Card Discount
â”‚   â””â”€> Automatic Discounts
â”‚
â””â”€> Total Calculation
    â””â”€> Uses discounts.finalTotal

Checkout Page (index.jsx)
â”œâ”€> Receives discounts from cart
â”œâ”€> Shows discount breakdown
â”œâ”€> Calculates final total
â””â”€> Records usage after order
```

---

## ğŸ”„ State Management

### **Cart Page State:**

```javascript
const [discounts, setDiscounts] = useState(null);

// When discount applied
onDiscountsCalculated={(calculatedDiscounts) => {
  setDiscounts(calculatedDiscounts);
}}

// Pass to checkout
history("/checkout", { 
  state: { 
    discounts,
    shippingAddress,
    // ... other data
  } 
});
```

### **Checkout Page State:**

```javascript
const [discounts, setDiscounts] = useState(null);

// Receive from cart
useEffect(() => {
  if (location.state?.discounts) {
    setDiscounts(location.state.discounts);
  }
}, [location.state]);

// Use in calculation
const finalTotal = discounts?.finalTotal || calculatedTotal;
```

---

## ğŸ“Š Database Schema

### **Coupon Document:**

```javascript
{
  _id: ObjectId,
  code: "SAVE20",
  description: "Save 20%",
  discountType: "percentage",
  discountAmount: 20,
  minimumAmount: 50,
  maximumAmount: 100,
  usageLimit: 1000,
  usageLimitPerUser: 1,
  usageCount: 45,
  startDate: Date,
  endDate: Date,
  isActive: true,
  freeShipping: false,
  usedBy: [
    {
      userId: ObjectId,
      orderId: ObjectId,
      usedAt: Date,
      discountApplied: 16
    }
  ]
}
```

### **Gift Card Document:**

```javascript
{
  _id: ObjectId,
  code: "ABCD-1234-EFGH",
  initialBalance: 100,
  currentBalance: 50,
  currency: "USD",
  recipientEmail: "customer@example.com",
  expiryDate: Date,
  isActive: true,
  usageHistory: [
    {
      orderId: ObjectId,
      amount: 50,
      balanceBefore: 100,
      balanceAfter: 50,
      usedAt: Date
    }
  ]
}
```

### **Order Document (with discounts):**

```javascript
{
  _id: ObjectId,
  userId: ObjectId,
  products: [...],
  totalAmt: 24,
  shippingCost: 10,
  discounts: {
    couponCode: "SAVE20",
    couponDiscount: 16,
    giftCardCode: "ABCD-1234",
    giftCardDiscount: 50,
    automaticDiscounts: [
      { type: "first_time_buyer", discount: 8 }
    ],
    totalDiscount: 74,
    freeShipping: false,
    subtotal: 80,
    finalTotal: 24
  }
}
```

---

## ğŸ§ª Testing Scenarios

### **Test 1: Valid Coupon**

```
Input:
- Code: SAVE20
- Cart Total: $100
- Min Required: $50

Expected:
âœ… Coupon applied
âœ… Discount: $20 (20% of $100)
âœ… Final Total: $80 + shipping
```

### **Test 2: Invalid Coupon**

```
Input:
- Code: INVALID
- Cart Total: $100

Expected:
âŒ Error: "Invalid coupon code"
âœ… No discount applied
âœ… Cart total unchanged
```

### **Test 3: Expired Coupon**

```
Input:
- Code: EXPIRED20
- End Date: 2023-12-31 (past)
- Cart Total: $100

Expected:
âŒ Error: "Coupon has expired"
âœ… No discount applied
```

### **Test 4: Minimum Not Met**

```
Input:
- Code: SAVE20
- Cart Total: $30
- Min Required: $50

Expected:
âŒ Error: "Minimum purchase amount of $50 required"
âœ… No discount applied
```

### **Test 5: Gift Card Partial Use**

```
Input:
- Gift Card Balance: $50
- Cart Total: $100

Expected:
âœ… Gift card applied
âœ… Discount: $50 (full balance)
âœ… Remaining to pay: $50
âœ… Gift card balance: $0
```

---

## ğŸ“ Learning Path

### **Beginner:**
1. âœ… Read Quick Start Guide
2. âœ… Create a test coupon
3. âœ… Test in cart
4. âœ… Create a gift card
5. âœ… Test gift card

### **Intermediate:**
1. âœ… Understand discount types
2. âœ… Set up restrictions
3. âœ… Monitor usage
4. âœ… Combine discounts
5. âœ… Use automatic discounts

### **Advanced:**
1. âœ… Create complex coupon rules
2. âœ… Set up email-specific coupons
3. âœ… Product-specific discounts
4. âœ… Category-specific discounts
5. âœ… Analyze discount effectiveness

---

## ğŸ“– Complete Documentation

- **Full Tutorial**: `DISCOUNT_SYSTEM_FULL_TUTORIAL.md`
- **Quick Start**: `DISCOUNT_SYSTEM_QUICK_START.md`
- **Implementation**: `DISCOUNT_SYSTEM_IMPLEMENTATION.md`
- **Completion Report**: `DISCOUNT_SYSTEM_COMPLETE.md`
- **Fixes Applied**: `DISCOUNT_SYSTEM_FIXES.md`

---

**Everything is documented and ready to use!** ğŸ‰

